cd ~/student-services_V4_Docker

# 1. Stop all Docker services
echo "ğŸ›‘ Stopping all services..."
docker compose down

# 2. Clear all Docker caches
echo "ğŸ§¹ Clearing Docker caches..."
docker system prune -af --volumes
docker builder prune -af

# 3. Clear any local caches
echo "ğŸ§¹ Clearing local caches..."
sudo rm -rf ./nginx_cache/* 2>/dev/null || true
sudo rm -rf ./logs/* 2>/dev/null || true

# 4. Rebuild everything from scratch
echo "ğŸ”¨ Rebuilding services..."
docker compose build --no-cache

# 5. Start services
echo "ğŸš€ Starting services..."
docker compose up -d

# 6. Wait for healthy status
echo "â³ Waiting for services to be healthy..."
sleep 20

# 7. Check status
docker compose ps

# 8. Check logs
echo ""
echo "ğŸ“‹ Recent logs:"
docker compose logs --tail=10 web

echo ""
echo "âœ… Server completely restarted!"
echo ""
echo "ğŸŒ Test URLs:"
echo "   https://elitestudentservices.online/admin"
echo ""
echo "âš ï¸  IMPORTANT: Clear your browser cache!"
echo "   Ctrl+Shift+Delete â†’ All time â†’ Clear"
